<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4fd1c5">
    
    <title>MateGeniu - Clasa a II-a</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&subset=latin-ext&display=swap');

        :root {
            --bg: #f0f4f8;
            --text: #2d3748;
            --primary: #4fd1c5;
            --secondary: #f6ad55;
            --accent: #fc8181;
            --success: #48bb78;
            --fire: #ff9f1c;
            --white: #ffffff;
            --shadow: 0 6px 12px rgba(0,0,0,0.15);
            --radius: 24px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #app {
            height: 100%;
            overflow-y: auto;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* --- SCREENS --- */
        .screen { display: none; padding: 20px; max-width: 650px; margin: 0 auto; width: 100%; flex-direction: column; align-items: center; padding-bottom: 80px; animation: fadeIn 0.3s ease; }
        .screen.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h1, h2 { text-align: center; margin: 10px 0; font-weight: 700; }
        h1 { font-size: 2.2rem; color: var(--primary); }

        /* --- BUTOANE --- */
        .btn { 
            background: var(--white); border: none; border-radius: var(--radius); padding: 20px; 
            width: 100%; margin-bottom: 15px; font-size: 1.2rem; font-weight: 700; cursor: pointer; 
            box-shadow: 0 5px 0 #cbd5e0; transition: transform 0.1s; display: flex; 
            align-items: center; justify-content: center; gap: 12px; font-family: 'Quicksand', sans-serif;
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 5px 0 #38b2ac; }
        .btn-secondary { background: var(--secondary); color: white; box-shadow: 0 5px 0 #dd6b20; }
        .btn-danger { background: #fff5f5; color: #e53e3e; border: 1px solid #feb2b2; }

        .btn-op { border-left: 15px solid #ccc; text-align: left; justify-content: flex-start; }
        .btn-op.add { border-color: #48bb78; }
        .btn-op.sub { border-color: #ed8936; }
        .btn-op.mul { border-color: #f56565; }
        .btn-op.mix { border-color: #667eea; }

        /* --- GAME HUD --- */
        .score-badge { background: white; padding: 12px 25px; border-radius: 50px; box-shadow: var(--shadow); font-weight: 800; font-size: 1.3rem; color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .question { font-size: 3.5rem; font-weight: 800; text-align: center; margin-bottom: 30px; }
        .timer-container { width: 100%; height: 10px; background: #e2e8f0; border-radius: 10px; margin-bottom: 20px; overflow: hidden; }
        .timer-bar { height: 100%; background: var(--primary); width: 100%; transition: width 0.1s linear; }

        /* --- CONTROLS --- */
        .grid-4 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; }
        .quiz-btn { height: 90px; font-size: 2.2rem; background: white; border-radius: var(--radius); border: none; font-weight: 800; box-shadow: 0 5px 0 #cbd5e0; cursor: pointer; font-family: 'Quicksand', sans-serif; }
        
        /* --- STATS CARDS --- */
        .stats-grid { display: flex; flex-direction: column; gap: 20px; width: 100%; }
        .stat-card { background: white; padding: 20px; border-radius: var(--radius); box-shadow: var(--shadow); border-top: 8px solid #ccc; }
        .level-badge { background: #f7fafc; padding: 10px; border-radius: 15px; text-align: center; margin-top: 10px; }
        
        .empty-state { text-align: center; padding: 40px 20px; background: white; border-radius: 30px; box-shadow: var(--shadow); width: 100%; }
        .empty-icon { font-size: 5rem; margin-bottom: 20px; display: block; }

        /* --- TOAST & MODALS --- */
        .toast { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); color: white; padding: 25px; border-radius: 20px; font-weight: bold; font-size: 1.5rem; opacity: 0; pointer-events: none; transition: 0.2s; z-index: 1000; text-align: center; }
        .toast.show { opacity: 1; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 1100; padding: 20px; }
        .modal-content { background: white; padding: 30px; border-radius: 30px; text-align: center; width: 100%; max-width: 500px; }

        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1200; display: none; }
    </style>
</head>
<body>
    <canvas id="confetti-canvas"></canvas>

    <div id="app">
        <div id="screen-login" class="screen active">
            <h1>üßÆ MateGeniu</h1>
            <input type="text" id="inp-name" style="width:100%; padding:20px; font-size:1.4rem; border-radius:20px; border:3px solid #cbd5e0; text-align:center; margin-bottom:20px; font-family: 'Quicksand';" placeholder="Scrie numele tƒÉu..." onkeypress="if(event.key==='Enter') login()">
            <button class="btn btn-primary" onclick="login()">‚ö° INTRƒÇ √éN JOC</button>
            <div id="user-list" style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:20px;"></div>
        </div>

        <div id="screen-menu" class="screen">
            <h1 id="greet">Salut! üöÄ</h1>
            <button class="btn btn-op add" onclick="selectOp('add')">‚ûï Adunare</button>
            <button class="btn btn-op sub" onclick="selectOp('sub')">‚ûñ ScƒÉdere</button>
            <button class="btn btn-op mul" onclick="selectOp('mul')">‚úñÔ∏è √énmul»õire</button>
            <button class="btn btn-op mix" onclick="selectOp('mix')">üé≤ Mixte</button>
            <button class="btn" style="background:#edf2f7; margin-top:20px;" onclick="showStats()">üìä STATISTICI</button>
            <button class="btn btn-danger" style="font-size:0.9rem; padding:10px;" onclick="location.reload()">üö™ Ie»ôire</button>
        </div>

        <div id="screen-level" class="screen">
            <h2>Alege dificultatea</h2>
            <button class="btn" onclick="startGame('easy')">üü¢ U»ôor</button>
            <button class="btn" onclick="startGame('medium')">üü° Mediu</button>
            <button class="btn" onclick="startGame('hard')">üî¥ Avansat</button>
            <button class="btn btn-secondary" onclick="showScreen('screen-menu')">‚¨Ö √éNAPOI</button>
        </div>

        <div id="screen-game" class="screen">
            <div class="timer-container"><div class="timer-bar" id="timer-bar"></div></div>
            <div class="score-badge">‚≠ê Scor: <span id="g-score">0</span></div>
            <div class="question" id="g-q">2 + 2 = ?</div>
            <div id="g-controls" class="grid-4"></div>
        </div>

        <div id="screen-stats" class="screen">
            <h2 id="stats-title">üìä Tablou de Onoare</h2>
            <div id="stats-container" class="stats-grid"></div>
            <div id="stats-footer" style="width:100%; margin-top:20px;"></div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-end">
        <div class="modal-content">
            <h2 style="font-size:3rem;">üèÜ</h2>
            <h3>Bravo! Joc terminat!</h3>
            <h1 id="final-score" style="font-size:3.5rem; color:var(--primary);">0</h1>
            <p>Puncte ob»õinute</p>
            <button class="btn btn-primary" onclick="showStats(); closeModal();">üìä VEZI STATISTICI</button>
            <button class="btn btn-secondary" onclick="showScreen('screen-menu'); closeModal();">üè† MENIU</button>
        </div>
    </div>

    <div class="toast" id="toast">Corect! üåü</div>

    <script>
        const DB_KEY = 'MateGeniu_V2025';
        let state = { user: '', op: '', lvl: '', score: 0, qIdx: 0, questions: [], timer: null };

        // --- LOGIN & UTILIZATORI ---
        function login() {
            const name = document.getElementById('inp-name').value.trim();
            if(!name) return;
            state.user = name;
            saveRecentUser(name);
            
            const hr = new Date().getHours();
            let greetText = hr < 12 ? "BunƒÉ diminea»õa" : (hr < 18 ? "BunƒÉ ziua" : "BunƒÉ seara");
            document.getElementById('greet').textContent = `${greetText}, ${name}! üöÄ`;
            showScreen('screen-menu');
        }

        function saveRecentUser(name) {
            let d = JSON.parse(localStorage.getItem(DB_KEY) || '{}');
            d.users = d.users || [];
            if(!d.users.includes(name)) d.users.push(name);
            localStorage.setItem(DB_KEY, JSON.stringify(d));
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function closeModal() { document.getElementById('modal-end').style.display = 'none'; }

        // --- LOGICA JOC ---
        function selectOp(op) { state.op = op; showScreen('screen-level'); }

        function startGame(lvl) {
            state.lvl = lvl; state.score = 0; state.qIdx = 0;
            state.questions = Array.from({length: 10}, () => generateQ(state.op, lvl));
            showScreen('screen-game');
            loadQuestion();
        }

        function generateQ(op, lvl) {
            let n1, n2, ans, currentOp = op;
            if(op === 'mix') currentOp = ['add', 'sub', 'mul'][Math.floor(Math.random()*3)];
            let max = lvl === 'easy' ? 10 : (lvl === 'medium' ? 30 : 100);
            
            if(currentOp === 'mul') {
                n1 = Math.floor(Math.random()*10); n2 = Math.floor(Math.random()*10);
                ans = n1 * n2;
            } else {
                n1 = Math.floor(Math.random()*max); n2 = Math.floor(Math.random()*max);
                if(currentOp === 'sub' && n1 < n2) [n1, n2] = [n2, n1];
                ans = currentOp === 'add' ? n1 + n2 : n1 - n2;
            }
            return { n1, n2, ans, op: currentOp };
        }

        function loadQuestion() {
            if(state.qIdx >= 10) return endGame();
            const q = state.questions[state.qIdx];
            const ops = { add: '+', sub: '-', mul: '√ó' };
            document.getElementById('g-q').textContent = `${q.n1} ${ops[q.op]} ${q.n2} = ?`;
            document.getElementById('g-score').textContent = state.score;
            
            const ctrl = document.getElementById('g-controls');
            ctrl.innerHTML = '';
            let choices = [q.ans];
            while(choices.length < 4) {
                let r = q.ans + Math.floor(Math.random()*10) - 5;
                if(r >= 0 && !choices.includes(r)) choices.push(r);
            }
            choices.sort(() => Math.random() - 0.5).forEach(c => {
                const b = document.createElement('button');
                b.className = 'quiz-btn'; b.textContent = c;
                b.onclick = () => checkAns(c);
                ctrl.appendChild(b);
            });

            startTimer();
        }

        function startTimer() {
            if(state.timer) clearInterval(state.timer);
            let time = 10;
            const bar = document.getElementById('timer-bar');
            state.timer = setInterval(() => {
                time -= 0.1;
                bar.style.width = (time * 10) + '%';
                if(time <= 0) { clearInterval(state.timer); checkAns(-1); }
            }, 100);
        }

        function checkAns(val) {
            clearInterval(state.timer);
            const correct = val === state.questions[state.qIdx].ans;
            const t = document.getElementById('toast');
            if(correct) {
                state.score += 10;
                t.textContent = "Corect! üåü"; t.style.background = "#48bb78";
            } else {
                t.textContent = val === -1 ? "Timpul a expirat! ‚è∞" : "Ups! Gre»ôit ‚ùå";
                t.style.background = "#fc8181";
            }
            t.classList.add('show');
            setTimeout(() => {
                t.classList.remove('show');
                state.qIdx++;
                loadQuestion();
            }, 1000);
        }

        function endGame() {
            saveScore();
            document.getElementById('final-score').textContent = state.score;
            document.getElementById('modal-end').style.display = 'flex';
            if(state.score > 50) startConfetti();
        }

        function saveScore() {
            let d = JSON.parse(localStorage.getItem(DB_KEY) || '{}');
            if(!d[state.user]) d[state.user] = {};
            const key = `${state.op}_${state.lvl}`;
            d[state.user][key] = Math.max(d[state.user][key] || 0, state.score);
            localStorage.setItem(DB_KEY, JSON.stringify(d));
        }

        // --- STATISTICI ---
        function showStats() {
            const container = document.getElementById('stats-container');
            const footer = document.getElementById('stats-footer');
            const d = JSON.parse(localStorage.getItem(DB_KEY) || '{}');
            const uData = d[state.user] || {};
            
            container.innerHTML = '';
            footer.innerHTML = '';

            const keys = Object.keys(uData);

            if(keys.length === 0) {
                // DacƒÉ e gol, apare DOAR butonul mare
                container.innerHTML = `
                    <div class="empty-state">
                        <span class="empty-icon">üìî</span>
                        <h2>Albumul tƒÉu e gol!</h2>
                        <p>Trebuie sƒÉ joci cel pu»õin un joc pentru a c√¢»ôtiga puncte »ôi trofee.</p>
                        <button class="btn btn-primary" onclick="showScreen('screen-menu')">‚ö° HAI SƒÇ JUCƒÇM!</button>
                    </div>
                `;
                document.getElementById('stats-title').style.display = 'none';
            } else {
                // DacƒÉ are date, apare titlul, cardurile »ôi butonul normal de revenire jos
                document.getElementById('stats-title').style.display = 'block';
                keys.forEach(k => {
                    const [op, lvl] = k.split('_');
                    const card = document.createElement('div');
                    card.className = 'stat-card';
                    card.style.borderColor = op === 'add' ? '#48bb78' : (op === 'sub' ? '#ed8936' : '#f56565');
                    card.innerHTML = `
                        <strong>${op.toUpperCase()} (${lvl})</strong>
                        <div class="level-badge">Cel mai bun scor: <b>${uData[k]} pct</b></div>
                    `;
                    container.appendChild(card);
                });
                // InjectƒÉm butonul de revenire doar √Æn acest caz
                footer.innerHTML = `<button class="btn btn-secondary" onclick="showScreen('screen-menu')">‚¨Ö √éNAPOI LA MENIU</button>`;
            }
            showScreen('screen-stats');
        }

        // --- CONFETTI ---
        function startConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            canvas.style.display = 'block';
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            let particles = Array.from({length: 100}, () => ({
                x: Math.random() * canvas.width, y: Math.random() * canvas.height - canvas.height,
                vx: Math.random() * 4 - 2, vy: Math.random() * 4 + 2,
                c: ['#4fd1c5','#f6ad55','#fc8181','#48bb78'][Math.floor(Math.random()*4)],
                s: Math.random() * 8 + 4
            }));
            function draw() {
                ctx.clearRect(0,0,canvas.width, canvas.height);
                particles.forEach(p => {
                    p.x += p.vx; p.y += p.vy;
                    ctx.fillStyle = p.c; ctx.fillRect(p.x, p.y, p.s, p.s);
                });
                if(particles[0].y < canvas.height) requestAnimationFrame(draw);
                else canvas.style.display = 'none';
            }
            draw();
        }
    </script>
</body>
</html>
